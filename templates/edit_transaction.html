{% extends "base.html" %}
{% block title %}Editar transação — FinCtrl{% endblock %}

{% block content %}
<div class="card p-4 shadow-soft mx-auto" style="max-width:720px;">
  <div class="d-flex align-items-center mb-3">
    <i class="bi bi-pencil-square text-primary fs-4 me-2"></i>
    <h4 class="mb-0">Editar transação</h4>
  </div>

  <form method="post" class="row g-3">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ next }}">

    <div class="col-md-4">
      <label class="form-label small text-muted">Data</label>
      <input type="date" name="date" class="form-control" value="{{ tx.date|date:'Y-m-d' }}" required>
    </div>

    <div class="col-md-8">
      <label class="form-label small text-muted">Descrição</label>
      <input type="text" name="description" class="form-control" value="{{ tx.description }}" required>
    </div>

    <div class="col-md-6">
      <label class="form-label small text-muted">Conta</label>
      <select name="account" class="form-select" required>
        {% for acc in accounts %}
          <option value="{{ acc.id }}" {% if tx.account_id == acc.id %}selected{% endif %}>{{ acc.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label class="form-label small text-muted">Categoria</label>
      <select name="category" class="form-select" required>
        {% for cat in categories %}
          <option value="{{ cat.id }}" {% if tx.category_id == cat.id %}selected{% endif %}>
            {{ cat.name }} — {% if cat.kind == "IN" %}Receita{% else %}Despesa{% endif %}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label class="form-label small text-muted">Valor</label>
      <div class="input-group">
        <span class="input-group-text">R$</span>
        <input type="number" step="0.01" name="amount" class="form-control" value="{{ tx.amount }}">
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label small text-muted">Status</label>
      <select name="status" class="form-select">
        {% for code,label in status_choices %}
          <option value="{{ code }}" {% if tx.status == code %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <div class="form-check mt-4">
        {% if tx.installment_count|default:0 > 1 %}
          <input class="form-check-input" type="checkbox" id="id_is_fixed" name="is_fixed" disabled>
          <label class="form-check-label" for="id_is_fixed">Despesa/Receita fixa</label>
          <div class="form-text">Lançamentos de <b>parcelas</b> não podem ser marcados como fixos.</div>
        {% else %}
          <input class="form-check-input" type="checkbox" id="id_is_fixed" name="is_fixed"
                 {% if tx.is_fixed %}checked{% endif %}>
          <label class="form-check-label" for="id_is_fixed">Despesa/Receita fixa</label>
          <div class="form-text">Marque para indicar que é um lançamento recorrente sem parcelas.</div>
        {% endif %}
      </div>
    </div>

    <div class="col-12 d-flex justify-content-end mt-3">
      <a href="{{ next }}" class="btn btn-light border me-2">← Voltar</a>
      <button type="submit" class="btn btn-primary"><i class="bi bi-save me-1"></i>Salvar alterações</button>
    </div>
  </form>
</div>
{% endblock %}
